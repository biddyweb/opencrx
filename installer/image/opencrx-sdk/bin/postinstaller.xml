<project 
	name="opencrx-sdk-postinstaller" 
	xmlns:antcontrib="antlib:net.sf.antcontrib"
>
	<property name="install.path" value="$INSTALL_PATH" />	
	<available file="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-core.jre-1.6.tar.gz" property="tar.gz.present" />		
	<available file="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-core.jre-1.6.zip" property="zip.present" />		
	<target name="expand-tar" if="tar.gz.present" >
		<gunzip src="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-core.jre-1.6.tar.gz" dest="${install.path}/repository/distribution"/>
		<untar src="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-core.jre-1.6.tar" dest="${install.path}" overwrite="false" />
		<gunzip src="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-test-core.jre-1.6.tar.gz" dest="${install.path}/repository/distribution"/>
		<untar src="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-test-core.jre-1.6.tar" dest="${install.path}" overwrite="false" />

		<mkdir dir="${install.path}/opencrx-$PROJECT_VERSION/opt"/>

		<gunzip src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-core.jre-1.6.tar.gz" dest="${install.path}/repository/distribution"/>
		<untar src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-core.jre-1.6.tar" dest="${install.path}/opencrx-$PROJECT_VERSION/opt" overwrite="false" />
		<gunzip src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-portal.jre-1.6.tar.gz" dest="${install.path}/repository/distribution"/>
		<untar src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-portal.jre-1.6.tar" dest="${install.path}/opencrx-$PROJECT_VERSION/opt" overwrite="false" />
		<gunzip src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-security.jre-1.6.tar.gz" dest="${install.path}/repository/distribution"/>
		<untar src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-security.jre-1.6.tar" dest="${install.path}/opencrx-$PROJECT_VERSION/opt" overwrite="false" />
	</target>
	<target name="expand-zip" if="zip.present">
		<unzip src="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-core.jre-1.6.zip" dest="${install.path}" overwrite="false" />
		<unzip src="${install.path}/repository/distribution/opencrx-${PROJECT_VERSION}-test-core.jre-1.6.zip" dest="${install.path}" overwrite="false" />

		<mkdir dir="${install.path}/opencrx-$PROJECT_VERSION/opt"/>

		<unzip src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-core.jre-1.6.zip" dest="${install.path}/opencrx-$PROJECT_VERSION/opt" overwrite="false" />
		<unzip src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-portal.jre-1.6.zip" dest="${install.path}/opencrx-$PROJECT_VERSION/opt" overwrite="false" />
		<unzip src="${install.path}/repository/distribution/openmdx-${OPENMDX_VERSION}-security.jre-1.6.zip" dest="${install.path}/opencrx-$PROJECT_VERSION/opt" overwrite="false" />
	</target>
	<target name="postinstall" depends="expand-tar, expand-zip">
		<delete>
			<fileset dir="${install.path}/opencrx-$PROJECT_VERSION/opt" includes="**/CVS"/>
		</delete>
		<!-- openCRX/Core -->
		<ant inheritAll="false" dir="${install.path}/opencrx-$PROJECT_VERSION/core" target="install-src"/>
		<ant inheritAll="false" dir="${install.path}/opencrx-$PROJECT_VERSION/core" target="deliverables"/>
		<ant inheritAll="false" dir="${install.path}/opencrx-$PROJECT_VERSION/core" target="assemble"/>
		<!-- openCRX/Test Core -->
		<ant inheritAll="false" dir="${install.path}/opencrx-$PROJECT_VERSION/test-core" target="install-src"/>
		<ant inheritAll="false" dir="${install.path}/opencrx-$PROJECT_VERSION/test-core" target="deliverables"/>
	</target>
</project>
